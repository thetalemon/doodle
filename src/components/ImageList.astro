---
import { Image } from 'astro:assets'

interface Props {
  list: Record<string, any>[]
  title: string
}

const { list, title } = Astro.props

const ITEM_BOX_SIZE = 280

const calcWidthAndHeight = (image: Record<string, any>) => {
  const width = Number(image.default.width)
  const height = Number(image.default.height)
  if (width > height) {
    const ratio = ITEM_BOX_SIZE / width
    const calcedWidth = width > ITEM_BOX_SIZE ? ITEM_BOX_SIZE : width
    const calcedHeight = height * ratio
    return {
      width: calcedWidth,
      height: calcedHeight,
    }
  } else {
    const ratio = ITEM_BOX_SIZE / height
    const calcedWidth = width * ratio
    const calcedHeight = height > ITEM_BOX_SIZE ? ITEM_BOX_SIZE : height
    return {
      width: calcedWidth,
      height: calcedHeight,
    }
  }
}

const mappedImages = list
  .map((image) => {
    const wh = calcWidthAndHeight(image)
    return {
      src: image.default.src,
      width: wh.width,
      height: wh.height,
      format: image.default.format,
    } as ImageMetadata
  })
  .reverse()
---

<h2>{title}</h2>
<ul>
  {
    mappedImages.map((image) => (
      <li>
        <Image src={image} alt='らくがき' class='js-content' />
      </li>
    ))
  }
</ul>

<style>
  ul {
    display: grid;
    grid-template-columns: repeat(auto-fill, 300px);
    row-gap: 20px;
    justify-content: center;
  }
  li {
    display: flex;
    justify-content: center;
    align-items: center;
  }
</style>
